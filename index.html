<!doctype html>
<html lang="sq">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vler√´suesi i Freskis√´ s√´ Ushqimit</title>

  <style>
:root{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  --bg:#0b1020; --card: rgba(255,255,255,.06);
  --stroke: rgba(255,255,255,.12); --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --accent: rgba(99,102,241,.95);
  --good: rgba(110,231,183,.95);
  --warn: rgba(251,191,36,.95);
  --bad: rgba(251,113,133,.95);
}

*{ box-sizing: border-box; }

body{
  margin:0;
  color:var(--text);
  background:
    radial-gradient(900px 500px at 20% 0%, rgba(99,102,241,.25), transparent 60%),
    radial-gradient(900px 500px at 85% 10%, rgba(34,211,238,.18), transparent 60%),
    linear-gradient(180deg, #050812, var(--bg));
}

.wrap{
  max-width: 980px;
  margin: 0 auto;
  padding: 18px 16px 40px;
}

.sub{
  margin:0 0 16px;
  color:var(--muted);
  line-height:1.35;
}

/* ---------- Aesthetic Top Bar ---------- */
.topbar{
  position: sticky;
  top: 0;
  z-index: 20;
  padding: 14px 0 10px;
  background: linear-gradient(180deg, rgba(5,8,18,.92), rgba(5,8,18,.55), transparent);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.topbarInner{
  max-width: 980px;
  margin: 0 auto;
  padding: 0 16px;
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 14px;
}

/* Logo */
.siteLogo{
  width: 194px; /* your desktop size */
  height: auto;
  object-fit: contain;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
}

/* Title */
.siteTitle{
  margin: 0;
  text-align: center;
  font-size: 28px;
  font-weight: 950;
  letter-spacing: -0.02em;
  text-shadow: 0 10px 22px rgba(0,0,0,.45);
}

/* IMPORTANT: match spacer width to logo width so title is truly centered */
.topbarSpacer{ width: 194px; }

/* ---------- Hero Card ---------- */
.heroCard{
  position: relative;
  margin: 16px 0 14px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.12);
  overflow: hidden;
  background:
    radial-gradient(500px 260px at 15% 30%, rgba(99,102,241,.35), transparent 60%),
    radial-gradient(460px 260px at 85% 30%, rgba(34,211,238,.22), transparent 60%),
    linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  box-shadow: 0 28px 70px rgba(0,0,0,.35);
}

.heroGlow{
  position: absolute;
  inset: -40px;
  background:
    radial-gradient(260px 260px at 22% 50%, rgba(255,255,255,.10), transparent 60%),
    radial-gradient(330px 280px at 88% 20%, rgba(255,255,255,.08), transparent 65%);
  pointer-events: none;
}

.heroContent{
  position: relative;
  padding: 34px 26px;
}

.heroTitle{
  margin: 0 0 10px;
  font-size: 44px;
  font-weight: 1000;
  letter-spacing: -0.03em;
  line-height: 1.05;
  text-shadow: 0 18px 35px rgba(0,0,0,.40);
}

.heroSubtitle{
  margin: 0;
  font-size: 18px;
  color: rgba(255,255,255,.74);
  line-height: 1.35;
}

/* ---------- Pills ---------- */
.pillRow{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom: 12px;
}

.pill{
  display:inline-block;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: var(--muted);
  font-size: 12.5px;
}

/* ---------- Layout ---------- */
.grid{
  display:grid;
  grid-template-columns: 1.05fr 1fr;
  gap:14px;
}

.card{
  background: var(--card);
  border:1px solid var(--stroke);
  border-radius: 16px;
  padding: 16px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.card h2{ margin:0 0 8px; font-size: 15px; }

label{
  display:block;
  margin:10px 0 6px;
  font-weight:800;
  font-size: 13px;
}

select, input, button{
  width:100%;
  padding: 12px 12px;
  border-radius: 12px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.22);
  color: var(--text);
  font-size: 16px;
  outline:none;
  line-height: 1.2;
}

button{
  cursor:pointer;
  font-weight:900;
  background: var(--accent);
  border:1px solid rgba(255,255,255,.18);
  min-height: 44px;
}
button:hover{ filter: brightness(1.05); }

.btnRow{
  display:flex;
  gap:10px;
  margin-top: 12px;
}
.btnSecondary{ background: rgba(255,255,255,.06); font-weight: 850; }

.row{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.note{
  color: var(--muted);
  font-size: 13px;
  line-height: 1.4;
  margin-top: 10px;
}

.status{
  margin-top: 10px;
  font-size: 13px;
  min-height: 18px;
  color: var(--muted);
}
.status.good{ color: var(--good); font-weight: 900; }
.status.bad{ color: var(--bad); font-weight: 900; }

.hintBox{
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.04);
  color: rgba(255,255,255,.72);
  font-size: 12.8px;
  line-height: 1.35;
}

/* ---------- Food image row ---------- */
.foodMediaRow{
  display:flex;
  gap:12px;
  align-items:center;
  margin: 10px 0 6px;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
}
.foodThumb{
  width: 62px;
  height: 62px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  overflow:hidden;
  flex: 0 0 auto;
}
.foodThumb img{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;
}
.foodMeta{ min-width: 0; }
.foodTitle{
  margin:0;
  font-weight: 950;
  font-size: 14px;
  line-height: 1.2;
}
.foodCat{
  margin: 4px 0 0;
  color: var(--muted);
  font-size: 12.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ---------- Result cards ---------- */
.resultStack{ display:flex; flex-direction:column; gap:12px; }

.bigBox{
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.22);
  border-radius: 14px;
  padding: 12px;
  position: relative;
  overflow:hidden;
}
.bigLabel{
  font-size: 12.5px;
  color: var(--muted);
  margin: 0 0 6px;
  letter-spacing: .01em;
}
.bigValue{
  font-size: 18px;
  font-weight: 950;
  margin: 0;
  line-height: 1.1;
}
.bigSub{
  margin: 6px 0 0;
  color: var(--muted);
  font-size: 12.5px;
  line-height: 1.35;
}
.divider{
  height:1px;
  background: rgba(255,255,255,.12);
  margin: 10px 0;
}
.smallMono{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12.8px;
  color: rgba(255,255,255,.82);
  white-space: pre-wrap;
  margin: 0;
}

/* Optional image inside urgency card */
.urgencyMedia{
  position:absolute;
  top: 10px;
  right: 10px;
  width: 56px;
  height: 56px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  overflow:hidden;
  background: rgba(255,255,255,.06);
  opacity: .92;
}
.urgencyMedia img{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;
}

/* Countdown chip */
.chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  font-size: 12.5px;
  color: rgba(255,255,255,.86);
  margin-top: 10px;
  width: fit-content;
}
.dot{
  width: 9px;
  height: 9px;
  border-radius: 999px;
  background: rgba(255,255,255,.6);
  box-shadow: 0 0 0 4px rgba(255,255,255,.08);
}
.chip.good .dot{ background: var(--good); box-shadow: 0 0 0 4px rgba(110,231,183,.18); }
.chip.warn .dot{ background: var(--warn); box-shadow: 0 0 0 4px rgba(251,191,36,.18); }
.chip.bad  .dot{ background: var(--bad);  box-shadow: 0 0 0 4px rgba(251,113,133,.18); }

.bigBox.good{ border-color: rgba(110,231,183,.25); }
.bigBox.warn{ border-color: rgba(251,191,36,.25); }
.bigBox.bad { border-color: rgba(251,113,133,.25); }

/* Select arrow */
select{
  appearance: none;
  -webkit-appearance: none;
  padding-right: 40px;
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(255,255,255,.75) 50%),
    linear-gradient(135deg, rgba(255,255,255,.75) 50%, transparent 50%);
  background-position:
    calc(100% - 18px) 55%,
    calc(100% - 12px) 55%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
}

/* ---------- Responsive ---------- */
@media (max-width: 900px){
  .grid{ grid-template-columns: 1fr; }
}

/* ‚úÖ Mobile fix: stack logo + title nicely */
@media (max-width: 560px){
  .wrap{ padding: 14px 12px 26px; }

  .topbar{
    padding: 10px 0 8px;
  }

  .topbarInner{
    display: flex;           /* override grid */
    flex-direction: column;  /* stack */
    align-items: center;
    gap: 8px;
    padding: 0 12px;
  }

  .topbarSpacer{ display: none; }

  .siteLogo{ width: 64px; }  /* mobile size */
  .siteTitle{
    font-size: 18px;
    line-height: 1.15;
    padding: 0 10px;
  }

  .heroContent{ padding: 22px 16px; }
  .heroTitle{ font-size: 30px; }
  .heroSubtitle{ font-size: 14.5px; }

  .card{ padding: 14px; border-radius: 14px; }
  .row{ grid-template-columns: 1fr; }
  .btnRow{ flex-direction:column; }
  .bigValue{ font-size: 20px; }

  .card{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}

@media (hover: none) and (pointer: coarse){
  .card{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
}
  </style>
</head>

<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="topbarInner">
      <img class="siteLogo" src="Logo.png" alt="Logo - Vler√´suesi i Freskis√´ s√´ Ushqimit" />
      <h1 class="siteTitle">Vler√´suesi i Freskis√´ s√´ Ushqimit</h1>
      <div class="topbarSpacer" aria-hidden="true"></div>
    </div>
  </header>

  <div class="wrap">
    <!-- Hero card -->
    <section class="heroCard">
      <div class="heroGlow" aria-hidden="true"></div>
      <div class="heroContent">
        <h2 class="heroTitle">Freskia fillon me ruajtjen</h2>
        <p class="heroSubtitle">Kontrollo datat ‚Ä¢ Ruaj ftoht√´ ‚Ä¢ Mos rreziko kur dyshon</p>
      </div>
    </section>

    <p class="sub">
      Vler√´sime t√´ kujdesshme dhe konservative. N√´se produkti ka dat√´ ‚Äúp√´rdoret deri / m√´ e mira para‚Äù, ndiqni at√´.
      Gjithmon√´ hidhni ushqimin q√´ ka er√´ ose pamje t√´ keqe.
    </p>

    <div class="pillRow">
      <span class="pill">Mir√´ deri = dritare cil√´sie</span>
      <span class="pill">Kufiri i sigurt = konservativ</span>
      <span class="pill">Num√´rim mbrapsht + ngjyra</span>
    </div>

    <div class="grid">
      <section class="card">
        <h2>Hyrjet</h2>

        <label for="search">K√´rko ushqim</label>
        <input id="search" placeholder="p.sh., qum√´sht, pul√´, oriz, domate‚Ä¶" />

        <label for="food">Ushqimi</label>
        <select id="food"></select>

        <div class="foodMediaRow" aria-live="polite">
          <div class="foodThumb">
            <img id="foodImg" alt="Foto e ushqimit" />
          </div>
          <div class="foodMeta">
            <p id="foodTitle" class="foodTitle">‚Äî</p>
            <p id="foodCat" class="foodCat">‚Äî</p>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="storage">Ruajtja</label>
            <select id="storage">
              <option value="fridge">Frigorifer</option>
              <option value="freezer">Ngrir√´s</option>
              <option value="pantry">Dollap / Temperatura e dhom√´s</option>
            </select>
          </div>
          <div>
            <label for="opened">I hapur?</label>
            <select id="opened">
              <option value="no">Jo / i mbyllur</option>
              <option value="yes">Po / i hapur</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="start">Data e fillimit</label>
            <input id="start" type="date" />
          </div>
          <div>
            <label for="startType">Data do t√´ thot√´‚Ä¶</label>
            <select id="startType">
              <option value="purchase">Data e blerjes / hapjes</option>
              <option value="label">Data n√´ etiket√´ (best-by/use-by)</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="temp">Temperatura (¬∞C)</label>
            <input id="temp" type="number" step="0.5" placeholder="Vendoset automatikisht" />
          </div>
          <div>
            <label>&nbsp;</label>
            <div class="hintBox">
              K√´shill√´: P√´r ushqimet e gatuara (mbetje), ‚Äúdata e fillimit‚Äù duhet t√´ jet√´ kur u gatua/u fut n√´ frigorifer.
            </div>
          </div>
        </div>

        <div class="btnRow">
          <button id="calc">Llogarit</button>
          <button id="reset" class="btnSecondary" type="button">Rivendos</button>
        </div>

        <div id="status" class="status"></div>

        <div class="note">
          Temperatura mund t√´ ndryshohet; vendoset automatikisht kur ndryshon ruajtja.
          Ngjyra e num√´rimit mbrapsht bazohet n√´ <b>kufirin e sigurt</b>.
        </div>
      </section>

      <section class="card">
        <h2>Rezultati</h2>

        <div class="resultStack">
          <div id="urgencyCard" class="bigBox">
            <div class="urgencyMedia" aria-hidden="true">
              <img id="urgencyImg" alt="" />
            </div>

            <p class="bigLabel">Num√´rimi mbrapsht (bazuar n√´ kufirin e sigurt)</p>
            <p id="countdownText" class="bigValue">‚Äî</p>

            <div id="countdownChip" class="chip" style="display:none;">
              <span class="dot"></span>
              <span id="chipText"></span>
            </div>

            <p id="countdownExplain" class="bigSub">‚Äî</p>
          </div>

          <div class="bigBox" id="qualityCard">
            <p class="bigLabel">Mir√´ deri m√´ (cil√´sia m√´ e mir√´)</p>
            <p id="goodUntil" class="bigValue">‚Äî</p>
            <p id="goodExplain" class="bigSub">‚Äî</p>
          </div>

          <div class="bigBox" id="cutoffCard">
            <p class="bigLabel">Kufiri i sigurt (m√´ konservativ)</p>
            <p id="cutoff" class="bigValue">‚Äî</p>
            <p id="cutoffExplain" class="bigSub">‚Äî</p>
          </div>

          <div class="bigBox">
            <p class="bigLabel">Sh√´nime</p>
            <p id="note" class="bigSub" style="margin:0;">‚Äî</p>

            <div class="divider"></div>
            <p class="bigLabel" style="margin-bottom:6px;">Detaje</p>
            <p id="details" class="smallMono">Zgjidh hyrjet dhe kliko ‚ÄúLlogarit‚Äù.</p>
          </div>
        </div>

        <div class="note">
          Nuk √´sht√´ k√´shill√´ mjek√´sore. Ushqimet me rrezik t√´ lart√´ (peshk, pul√´, oriz i gatuar) k√´rkojn√´ kujdes shtes√´.
        </div>
      </section>
    </div>
  </div>

  <script>
    /* Icons */
    const IMG = {
      fallback: coloredTile("?", "#ffffff"),
      milk: iconMilk(),
      feta_cheese: iconCheese(),
      eggs_shell: iconEggs(),
      raw_chicken: iconChicken(),
      raw_chicken_breast: iconChicken(),
      raw_beef: iconBeef(),
      ham_deli: iconHam(),
      raw_fish: iconFish(),
      cooked_rice: iconRice(),
      cooked_pasta: iconPasta(),
      bread: iconBread(),
      tomatoes: iconTomato(),
    };

    function svgDataUrl(svg){
      return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg.trim());
    }
    function coloredTile(letter, color){
      return svgDataUrl(`
        <svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140">
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0" stop-color="rgba(99,102,241,0.55)"/>
              <stop offset="1" stop-color="rgba(34,211,238,0.35)"/>
            </linearGradient>
          </defs>
          <rect width="140" height="140" rx="22" fill="rgba(255,255,255,0.06)"/>
          <rect x="8" y="8" width="124" height="124" rx="18" fill="url(#g)"/>
          <text x="70" y="84" text-anchor="middle" font-family="system-ui,Segoe UI,Arial"
                font-size="64" font-weight="900" fill="${color}" fill-opacity="0.9">${letter}</text>
        </svg>
      `);
    }

    function iconMilk(){ return coloredTile("ü•õ", "#ffffff"); }
    function iconCheese(){ return coloredTile("üßÄ", "#ffffff"); }
    function iconEggs(){ return coloredTile("ü•ö", "#ffffff"); }
    function iconChicken(){ return coloredTile("üçó", "#ffffff"); }
    function iconBeef(){ return coloredTile("ü•©", "#ffffff"); }
    function iconHam(){ return coloredTile("üçñ", "#ffffff"); }
    function iconFish(){ return coloredTile("üêü", "#ffffff"); }
    function iconRice(){ return coloredTile("üçö", "#ffffff"); }
    function iconPasta(){ return coloredTile("üçù", "#ffffff"); }
    function iconBread(){ return coloredTile("üçû", "#ffffff"); }
    function iconTomato(){ return coloredTile("üçÖ", "#ffffff"); }

    const DB = [
      { cat:"Bulmet", id:"milk", name:"Qum√´sht", highRisk:false,
        rules:{ fridge:{ sealed:[7,10], opened:[5,7] }, freezer:{ sealed:[90,180], opened:[90,180] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Mbaje n√´ ‚â§4¬∞C. Hidhet n√´se ka er√´ t√´ thart√´, mpiksje, ose shije t√´ √ßuditshme."
      },
      { cat:"Bulmet", id:"feta_cheese", name:"Djath√´ feta", highRisk:false,
        rules:{ fridge:{ sealed:[7,14], opened:[5,10] }, freezer:{ sealed:[90,180], opened:[90,180] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Mbaje t√´ mbyllur mir√´ dhe t√´ ftoht√´. Hidhet n√´se myku p√´rhapet ose ka er√´ t√´ keqe."
      },
      { cat:"Bulmet", id:"eggs_shell", name:"Vez√´ (t√´ pap√´rpunuara, me l√´vozhg√´)", highRisk:false,
        rules:{ fridge:{ sealed:[21,35], opened:[21,35] }, freezer:{ sealed:[0,0], opened:[0,0] }, pantry:{ sealed:[7,14], opened:[7,14] } },
        note:"M√´ mir√´ n√´ frigorifer. Mos i p√´rdor n√´se jan√´ t√´ √ßara ose kan√´ er√´ t√´ fort√´."
      },

      { cat:"Mish & Shpend", id:"raw_chicken", name:"Pul√´ e pap√´rpunuar", highRisk:true,
        rules:{ fridge:{ sealed:[1,2], opened:[1,2] }, freezer:{ sealed:[180,365], opened:[180,365] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Shum√´ e prishshme. Ruaje menj√´her√´ n√´ t√´ ftoht√´; shmang kontaminimin."
      },
      { cat:"Mish & Shpend", id:"raw_chicken_breast", name:"Gjoks pule (i pap√´rpunuar)", highRisk:true,
        rules:{ fridge:{ sealed:[1,2], opened:[1,2] }, freezer:{ sealed:[180,365], opened:[180,365] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Shum√´ e prishshme. Ruaje menj√´her√´ n√´ frigorifer dhe p√´rdor d√´rras√´ t√´ ve√ßant√´."
      },
      { cat:"Mish & Shpend", id:"raw_beef", name:"Mish vi√ßi (i pap√´rpunuar)", highRisk:true,
        rules:{ fridge:{ sealed:[2,4], opened:[1,2] }, freezer:{ sealed:[180,365], opened:[180,365] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Mbaje n√´ ‚â§4¬∞C. Hidhet n√´se ka er√´ t√´ keqe ose sip√´rfaqe ngjit√´se/slimy."
      },
      { cat:"Mish & Shpend", id:"ham_deli", name:"Proshut√´ (e prer√´ / deli)", highRisk:true,
        rules:{ fridge:{ sealed:[3,5], opened:[3,5] }, freezer:{ sealed:[30,60], opened:[30,60] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Produkt me rrezik m√´ t√´ lart√´. Ruaje shum√´ ftoht√´ dhe p√´rdore shpejt pas hapjes."
      },

      { cat:"Peshk/Deti", id:"raw_fish", name:"Peshk (i pap√´rpunuar)", highRisk:true,
        rules:{ fridge:{ sealed:[1,2], opened:[1,2] }, freezer:{ sealed:[90,180], opened:[90,180] }, pantry:{ sealed:[0,0], opened:[0,0] } },
        note:"Shum√´ i prishsh√´m. Hidhet n√´se ka er√´ t√´ fort√´/amoniak ose tekstur√´ t√´ rr√´shqitshme."
      },

      { cat:"Ushqime t√´ gatuara", id:"cooked_rice", name:"Oriz i gatuar (mbetje)", highRisk:true,
        rules:{ fridge:{ sealed:[3,4], opened:[2,3] }, freezer:{ sealed:[60,90], opened:[60,90] }, pantry:{ sealed:[0,1], opened:[0,1] } },
        note:"Rrezik m√´ i lart√´ n√´se lihet jasht√´. Ftohe shpejt dhe fut n√´ frigorifer."
      },
      { cat:"Ushqime t√´ gatuara", id:"cooked_pasta", name:"Makarona t√´ gatuara (mbetje)", highRisk:true,
        rules:{ fridge:{ sealed:[3,4], opened:[2,3] }, freezer:{ sealed:[60,90], opened:[60,90] }, pantry:{ sealed:[0,1], opened:[0,1] } },
        note:"Ftohe shpejt dhe ruaje n√´ frigorifer. Hidhet n√´se ka er√´/shije t√´ dyshimt√´."
      },

      { cat:"Furr√´/Buke", id:"bread", name:"Buk√´ (e prer√´ / loaf)", highRisk:false,
        rules:{ pantry:{ sealed:[4,7], opened:[3,5] }, fridge:{ sealed:[4,7], opened:[3,5] }, freezer:{ sealed:[30,90], opened:[30,90] } },
        note:"Ngrir√´si e ruan m√´ mir√´. N√´se shfaqet myk, hidhe t√´ gjith√´ buk√´n."
      },

      { cat:"Perime/Fruta", id:"tomatoes", name:"Domate", highRisk:false,
        rules:{ fridge:{ sealed:[4,7], opened:[2,4] }, freezer:{ sealed:[60,180], opened:[60,180] }, pantry:{ sealed:[3,7], opened:[1,2] } },
        note:"M√´ e shijshme n√´ temperatur√´ dhome; fut n√´ frigorifer kur √´sht√´ shum√´ e pjekur ose e prer√´."
      },
    ];

    const DEFAULT_TEMP_C = { fridge: 4, freezer: -18, pantry: 20 };

    function $(id){ return document.getElementById(id); }
    function setStatus(text, kind){
      const el = $("status");
      el.textContent = text || "";
      el.className = "status" + (kind ? " " + kind : "");
    }

    function fmtDate(d){
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }
    function addDays(dateObj, days){
      const d = new Date(dateObj);
      d.setDate(d.getDate() + days);
      return d;
    }

    function getRule(item, storage, opened){
      const key = opened ? "opened" : "sealed";
      return item.rules?.[storage]?.[key] ?? null;
    }

    function buildOptions(list){
      const byCat = {};
      for (const item of list) (byCat[item.cat] ||= []).push(item);
      const cats = Object.keys(byCat).sort((a,b)=>a.localeCompare(b));
      $("food").innerHTML = cats.map(cat => {
        const items = byCat[cat].sort((a,b)=>a.name.localeCompare(b.name));
        return `<optgroup label="${cat}">${
          items.map(i => `<option value="${i.id}">${i.name}</option>`).join("")
        }</optgroup>`;
      }).join("");

      if (!$("food").value) {
        const first = $("food").querySelector("option");
        if (first) $("food").value = first.value;
      }
    }

    function autoFillTempForStorage(storage){
      $("temp").value = DEFAULT_TEMP_C[storage];
    }

    function daysBetweenUTC(a, b){
      const msPerDay = 24 * 60 * 60 * 1000;
      const ua = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
      const ub = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
      return Math.floor((ub - ua) / msPerDay);
    }

    function urgencyFromDaysLeft(daysLeft){
      if (daysLeft >= 3) return "good";
      if (daysLeft >= 1) return "warn";
      return "bad";
    }

    function setUrgencyUI(daysLeft, cutoffDate){
      const card = $("urgencyCard");
      const chip = $("countdownChip");
      const chipText = $("chipText");
      const main = $("countdownText");
      const explain = $("countdownExplain");

      const u = urgencyFromDaysLeft(daysLeft);

      card.classList.remove("good","warn","bad");
      card.classList.add(u);

      chip.style.display = "inline-flex";
      chip.classList.remove("good","warn","bad");
      chip.classList.add(u);

      if (daysLeft > 1) {
        main.textContent = `${daysLeft} dit√´ t√´ mbetura`;
        chipText.textContent = u === "good" ? "N√´ rregull (p√´r momentin)" : "Po afrohet";
        explain.textContent = `Koha e mbetur deri te kufiri i sigurt (${fmtDate(cutoffDate)}).`;
        return;
      }
      if (daysLeft === 1) {
        main.textContent = `1 dit√´ e mbetur`;
        chipText.textContent = "P√´rdore shpejt";
        explain.textContent = `Kufiri i sigurt √´sht√´ nes√´r (${fmtDate(cutoffDate)}).`;
        return;
      }
      if (daysLeft === 0) {
        main.textContent = `Kufiri √´sht√´ sot`;
        chipText.textContent = "Dita e fundit (konservativ)";
        explain.textContent = `Kufiri i sigurt √´sht√´ sot (${fmtDate(cutoffDate)}). Kujdes.`;
        return;
      }

      const daysPast = Math.abs(daysLeft);
      main.textContent = `Pas kufirit me ${daysPast} dit√´`;
      chipText.textContent = "Mos e rreziko";
      explain.textContent = `Kufiri i sigurt ishte ${fmtDate(cutoffDate)}. N√´se dyshon, hidhe.`;
    }

    function setResultUI({goodUntilText, goodExplain, cutoffText, cutoffExplain, note, details, countdown}){
      $("goodUntil").textContent = goodUntilText;
      $("goodExplain").textContent = goodExplain;
      $("cutoff").textContent = cutoffText;
      $("cutoffExplain").textContent = cutoffExplain;
      $("note").textContent = note;
      $("details").textContent = details;

      if (!countdown){
        $("countdownText").textContent = "‚Äî";
        $("countdownExplain").textContent = "‚Äî";
        $("countdownChip").style.display = "none";
        $("urgencyCard").classList.remove("good","warn","bad");
        return;
      }
      setUrgencyUI(countdown.daysLeft, countdown.cutoffDate);
    }

    function updateStorageOptions(){
      const foodId = $("food").value;
      const opened = $("opened").value === "yes";
      const item = DB.find(x => x.id === foodId);
      if (!item) return;

      const storageSel = $("storage");

      for (const opt of storageSel.options){
        const storage = opt.value;
        const rule = getRule(item, storage, opened);
        const invalid = !rule || rule[1] === 0;
        opt.disabled = invalid;
      }

      const currentOpt = storageSel.options[storageSel.selectedIndex];
      if (currentOpt && currentOpt.disabled){
        const firstEnabled = [...storageSel.options].find(o => !o.disabled);
        if (firstEnabled){
          storageSel.value = firstEnabled.value;
          autoFillTempForStorage(storageSel.value);
        }
      }
    }

    function adjustRangeForStartType({ item, storage, opened, startType, minDays, maxDays }){
      if (startType !== "label") return { minDays, maxDays };

      if (item.id === "milk" && storage === "fridge") {
        return opened ? { minDays: 3, maxDays: 5 } : { minDays: 5, maxDays: 7 };
      }
      if (item.highRisk && storage === "fridge") {
        return { minDays: Math.min(minDays, 2), maxDays: Math.min(maxDays, 3) };
      }
      return { minDays, maxDays };
    }

    function estimate(){
      const foodId = $("food").value;
      const storage = $("storage").value;
      const opened = $("opened").value === "yes";
      const startStr = $("start").value;
      const startType = $("startType").value;

      const tempVal = $("temp").value.trim();
      const tempC = tempVal === "" ? NaN : Number(tempVal);

      const item = DB.find(x => x.id === foodId);
      if (!item) throw new Error("Ushqim i panjohur.");
      if (!startStr) throw new Error("Zgjidhni nj√´ dat√´ fillimi.");

      const start = new Date(startStr + "T00:00:00");
      if (!Number.isFinite(start.getTime())) throw new Error("Dat√´ e pavlefshme.");

      const rule = getRule(item, storage, opened);
      if (!rule) throw new Error("Nuk ka rregull p√´r k√´t√´ kombinim.");

      if (rule[1] === 0) {
        setStatus("Nuk ka vler√´sim t√´ sigurt p√´r k√´t√´ m√´nyr√´ ruajtjeje.", "bad");
        return {
          goodUntilText: "Nuk rekomandohet",
          goodExplain: "Ky ushqim zakonisht nuk duhet ruajtur k√´shtu.",
          cutoffText: "Nuk rekomandohet",
          cutoffExplain: "P√´rdor udh√´zimet p√´r frigorifer/ngrir√´s.",
          note: item.note,
          details: [
            `Ushqimi: ${item.name} (${item.cat})`,
            `Ruajtja: ${storage}, ${opened ? "i hapur" : "i mbyllur"}`,
            `Data e fillimit: ${fmtDate(start)}`,
            `Kuptimi i dat√´s: ${startType === "purchase" ? "blerje/hapje" : "etiket√´"}`,
            ``,
            `Nuk ka vler√´sim t√´ sigurt p√´r k√´t√´ kombinim.`
          ].join("\n"),
          countdown: null
        };
      }

      let [minDays, maxDays] = rule;
      ({ minDays, maxDays } = adjustRangeForStartType({ item, storage, opened, startType, minDays, maxDays }));

      if (item.highRisk && storage !== "freezer") {
        minDays = Math.max(0, minDays - 1);
        maxDays = Math.max(minDays, maxDays - 1);
      }

      const goodMinDate = addDays(start, minDays);
      const goodMaxDate = addDays(start, maxDays);
      const cutoffDate = addDays(start, minDays);

      const now = new Date();
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      const daysLeft = daysBetweenUTC(today, cutoffDate);

      const tempInfo = Number.isFinite(tempC) ? `${tempC}¬∞C` : "(pa temperatur√´)";
      const openingInfo = opened ? "i hapur" : "i mbyllur";

      setStatus("Vler√´sim i b√´r√´ ‚úî (data n√´ paketim ka p√´rpar√´si n√´se e keni)", "good");

      return {
        goodUntilText: `${fmtDate(goodMaxDate)}`,
        goodExplain: `Cil√´sia m√´ e mir√´ zakonisht √´sht√´ nga ${fmtDate(goodMinDate)} deri m√´ ${fmtDate(goodMaxDate)}.`,
        cutoffText: `${fmtDate(cutoffDate)}`,
        cutoffExplain: `Kjo p√´rdor fundin e hersh√´m t√´ intervalit p√´r t√´ qen√´ m√´ e kujdesshme.`,
        note: item.note,
        details: [
          `Ushqimi: ${item.name} (${item.cat})`,
          `Data e fillimit: ${fmtDate(start)}`,
          `Kuptimi i dat√´s: ${startType === "purchase" ? "blerje/hapje" : "etiket√´"}`,
          `Ruajtja: ${storage} (${tempInfo}), ${openingInfo}`,
          `Rregulli (dit√´): [${rule[0]}, ${rule[1]}]`,
          `I rregulluar (dit√´): [${minDays}, ${maxDays}]`,
          `Num√´rimi mbrapsht p√´rdor kufirin e sigurt.`
        ].join("\n"),
        countdown: { daysLeft, cutoffDate }
      };
    }

    function updateFoodMedia(){
      const foodId = $("food").value;
      const item = DB.find(x => x.id === foodId);

      const src = (item && IMG[item.id]) ? IMG[item.id] : IMG.fallback;
      $("foodImg").src = src;
      $("urgencyImg").src = src;

      $("foodTitle").textContent = item ? item.name : "‚Äî";
      $("foodCat").textContent = item ? item.cat : "‚Äî";
      $("foodImg").alt = item ? `Foto/ikon√´ p√´r: ${item.name}` : "Foto e ushqimit";
    }

    function resetUI(){
      const today = new Date();
      $("start").value = fmtDate(today);
      $("storage").value = "fridge";
      $("opened").value = "no";
      $("startType").value = "purchase";
      $("search").value = "";

      buildOptions(DB);
      autoFillTempForStorage("fridge");
      updateStorageOptions();
      updateFoodMedia();

      setStatus("", "");
      setResultUI({
        goodUntilText:"‚Äî",
        goodExplain:"‚Äî",
        cutoffText:"‚Äî",
        cutoffExplain:"‚Äî",
        note:"‚Äî",
        details:"Zgjidh hyrjet dhe kliko ‚ÄúLlogarit‚Äù.",
        countdown: null
      });
    }

    function init(){
      resetUI();

      $("storage").addEventListener("change", (e) => autoFillTempForStorage(e.target.value));
      $("food").addEventListener("change", () => { updateStorageOptions(); updateFoodMedia(); });
      $("opened").addEventListener("change", updateStorageOptions);

      $("search").addEventListener("input", (e) => {
        const q = e.target.value.trim().toLowerCase();
        const filtered = q
          ? DB.filter(x => (x.name + " " + x.cat).toLowerCase().includes(q))
          : DB;
        buildOptions(filtered);
        updateStorageOptions();
        updateFoodMedia();
      });

      $("calc").addEventListener("click", () => {
        try{
          const r = estimate();
          setResultUI(r);
        }catch(e){
          setStatus(e.message || String(e), "bad");
          setResultUI({
            goodUntilText:"‚Äî",
            goodExplain:"Rregullo hyrjet dhe provo p√´rs√´ri.",
            cutoffText:"‚Äî",
            cutoffExplain:"‚Äî",
            note:"‚Äî",
            details:"Gabim: " + (e.message || String(e)),
            countdown: null
          });
        }
      });

      $("reset").addEventListener("click", resetUI);
    }

    init();
  </script>
</body>
</html>
